(function(i,d){typeof exports=="object"&&typeof module<"u"?module.exports=d(require("qrcode"),require("jsqr")):typeof define=="function"&&define.amd?define(["qrcode","jsqr"],d):(i=typeof globalThis<"u"?globalThis:i||self,i.JsQRGB=d(i.qrcode,i.jsqr))})(this,function(i,d){"use strict";var q=Object.defineProperty;var y=(i,d,b)=>d in i?q(i,d,{enumerable:!0,configurable:!0,writable:!0,value:b}):i[d]=b;var f=(i,d,b)=>y(i,typeof d!="symbol"?d+"":d,b);const b=a=>new Uint8Array([...a,...new Array(3-a.length%3).fill(0).map((t,n)=>n)]),m=(a,t)=>{const n=document.createElement("canvas"),e=n.getContext("2d");return i.toCanvas(n,[{data:a,mode:"byte"}],t),e.getImageData(0,0,t.width,t.height)},l=(a,t)=>{const{size:n=600}=t||{},e=typeof a=="string"?new TextEncoder().encode(a):a,h=b(e),o={r:h.slice(0,h.length/3),g:h.slice(h.length/3,h.length/3*2),b:h.slice(h.length/3*2,h.length)},u={r:m(o.r,{width:n,height:n}),g:m(o.g,{width:n,height:n}),b:m(o.b,{width:n,height:n})},s=new ImageData(n,n);for(let g=0;g<s.data.length;g+=4)s.data[g]=u.r.data[g],s.data[g+1]=u.g.data[g+1],s.data[g+2]=u.b.data[g+2],s.data[g+3]=255;return s},w=a=>a.slice(0,a.length-a[a.length-1]);class D{constructor(t){f(this,"threshold");f(this,"min");f(this,"max");f(this,"cache",new Map);f(this,"binarization",t=>{if(this.cache.has(t))return this.cache.get(t);const n=t>=this.threshold?this.max:this.min;return this.cache.set(t,n),n});t===void 0||(t={}),this.threshold=(t==null?void 0:t.threshold)??150,this.min=(t==null?void 0:t.min)??0,this.max=(t==null?void 0:t.max)??255}}return{generate:l,recognize:a=>{const{width:t,height:n}=a,e={r:new ImageData(t,n),g:new ImageData(t,n),b:new ImageData(t,n)},h=new D().binarization;for(let r=0;r<a.data.length;r+=4){const c={r:h(a.data[r]),g:h(a.data[r+1]),b:h(a.data[r+2]),a:255};e.r.data[r]=c.r,e.r.data[r+1]=c.r,e.r.data[r+2]=c.r,e.r.data[r+3]=c.a,e.g.data[r]=c.g,e.g.data[r+1]=c.g,e.g.data[r+2]=c.g,e.g.data[r+3]=c.a,e.b.data[r]=c.b,e.b.data[r+1]=c.b,e.b.data[r+2]=c.b,e.b.data[r+3]=c.a}const o=d(e.r.data,e.r.width,e.r.height),u=d(e.g.data,e.g.width,e.g.height),s=d(e.b.data,e.b.width,e.b.height);if(!o||!u||!s)return;const g=new Uint8Array([...o.binaryData,...u.binaryData,...s.binaryData]);return w(g)}}});
