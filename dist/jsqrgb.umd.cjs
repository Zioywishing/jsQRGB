(function(g,s){typeof exports=="object"&&typeof module<"u"?module.exports=s(require("qrcode"),require("jsqr")):typeof define=="function"&&define.amd?define(["qrcode","jsqr"],s):(g=typeof globalThis<"u"?globalThis:g||self,g.JsQRGB=s(g.qrcode,g.jsqr))})(this,function(g,s){"use strict";var k=Object.defineProperty;var j=(g,s,f)=>s in g?k(g,s,{enumerable:!0,configurable:!0,writable:!0,value:f}):g[s]=f;var w=(g,s,f)=>j(g,typeof s!="symbol"?s+"":s,f);const f=t=>new Uint8Array([...t,...new Array(3-t.length%3).fill(0).map((e,r)=>r)]),u=(t,e)=>{const r=new OffscreenCanvas(e.width,e.height),a=r.getContext("2d");return g.toCanvas(r,[{data:t,mode:"byte"}],e),a.getImageData(0,0,e.width,e.height)},b=(t,e)=>{const{size:r=600}=e||{},a=typeof t=="string"?new TextEncoder().encode(t):t,d=f(a),i={r:new Uint8Array([0,...d.slice(0,d.length/3)]),g:new Uint8Array([1,...d.slice(d.length/3,d.length*2/3)]),b:new Uint8Array([2,...d.slice(d.length*2/3,d.length)])},m={r:u(i.r,{width:r,height:r}),g:u(i.g,{width:r,height:r}),b:u(i.b,{width:r,height:r})},o=new ImageData(r,r);for(let h=0;h<o.data.length;h+=4)o.data[h]=m.r.data[h],o.data[h+1]=m.g.data[h+1],o.data[h+2]=m.b.data[h+2],o.data[h+3]=255;return o},l=t=>t.slice(0,t.length-t[t.length-1]);class y{constructor(e){w(this,"threshold");w(this,"min");w(this,"max");w(this,"cache",new Map);w(this,"binarization",e=>{if(this.cache.has(e))return this.cache.get(e);const r=e>=this.threshold?this.max:this.min;return this.cache.set(e,r),r});e===void 0||(e={}),this.threshold=(e==null?void 0:e.threshold)??150,this.min=(e==null?void 0:e.min)??0,this.max=(e==null?void 0:e.max)??255}}const D=t=>{const{width:e,height:r}=t,a={r:new ImageData(e,r),g:new ImageData(e,r),b:new ImageData(e,r)},d=new y().binarization;for(let n=0;n<t.data.length;n+=4){const c={r:d(t.data[n]),g:d(t.data[n+1]),b:d(t.data[n+2]),a:255};a.r.data[n]=c.r,a.r.data[n+1]=c.r,a.r.data[n+2]=c.r,a.r.data[n+3]=c.a,a.g.data[n]=c.g,a.g.data[n+1]=c.g,a.g.data[n+2]=c.g,a.g.data[n+3]=c.a,a.b.data[n]=c.b,a.b.data[n+1]=c.b,a.b.data[n+2]=c.b,a.b.data[n+3]=c.a}const i=s(a.r.data,a.r.width,a.r.height),m=s(a.g.data,a.g.width,a.g.height),o=s(a.b.data,a.b.width,a.b.height);if(!i||!m||!o)return;const h=new Uint8Array([i.binaryData,m.binaryData,o.binaryData].sort((n,c)=>n[0]-c[0]).map(n=>n.slice(1)).flat());return l(h)};function q(t){return new Worker("/assets/generate-BPkU51SX.js",{name:t==null?void 0:t.name})}function x(...t){const e=new q,r=new Promise((a,d)=>{e.addEventListener("message",i=>{a(i.data)}),e.addEventListener("error",i=>{d(i.error)})});return e.postMessage(t),r.finally(()=>{e.terminate()})}function A(t){return new Worker("/assets/recognize-ff6OA219.js",{name:t==null?void 0:t.name})}async function z(...t){const e=new A,r=new Promise((a,d)=>{e.addEventListener("message",i=>{console.log("r",i.data),a(i.data)}),e.addEventListener("error",i=>{d(i.error)})});return e.postMessage(t),r.finally(()=>{e.terminate()})}return{generate:b,recognize:D,generateAsync:x,recognizeAsync:z}});
